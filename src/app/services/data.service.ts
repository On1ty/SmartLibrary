import { Injectable } from '@angular/core';
import { addDoc, collection, collectionData, deleteDoc, doc, docData, Firestore } from '@angular/fire/firestore';
import { updateDoc } from '@firebase/firestore';
import * as moment from 'moment';

@Injectable({
  providedIn: 'root'
})
export class DataService {

  constructor(
    private firestore: Firestore
  ) { }

  testConnection() {
    const testConnectionRef = collection(this.firestore, 'test_connection');
    return collectionData(testConnectionRef);
  }

  getBooks() {
    const ref = collection(this.firestore, 'books');
    return collectionData(ref, { idField: 'id' });
  }

  getBooksById(id) {
    const ref = doc(this.firestore, `books/${id}`);
    return docData(ref, { idField: 'id' });
  }

  getBorrowersById(id) {
    const ref = doc(this.firestore, `borrowers/${id}`);
    return docData(ref, { idField: 'id' });
  }

  getUsers() {
    const ref = collection(this.firestore, 'users');
    return collectionData(ref);
  }

  getBorrowers() {
    const ref = collection(this.firestore, 'borrowers');
    return collectionData(ref, { idField: 'id' });
  }

  addBook(book) {
    const ref = collection(this.firestore, 'books')
    return addDoc(ref, book);
  }

  addBorrower(borrower) {
    const ref = collection(this.firestore, 'borrowers')
    return addDoc(ref, borrower);
  }

  addLibrarian(librarian) {
    const ref = collection(this.firestore, 'users')
    return addDoc(ref, librarian);
  }

  deleteBook(id) {
    const ref = doc(this.firestore, `books/${id}`)
    return deleteDoc(ref);
  }

  updateBook(book) {
    const ref = doc(this.firestore, `books/${book.id}`);
    return updateDoc(ref, { status: book.status })
  }

  deleteBorrower(id) {
    const ref = doc(this.firestore, `borrowers/${id}`)
    return deleteDoc(ref);
  }

  getCurrentDate() {
    return moment().format("MM/DD/YYYY");
  }

  getAltBookImage() {
    return "data:image/jpeg;base64,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";
  }
}
